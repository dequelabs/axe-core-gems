version: 2.1

defaults: &defaults
  docker:
    - image: circleci/ruby:2.4.3-node-browsers
  working_directory: ~/axe-core-gems

commands:
  install-bundler: 
    description: Install bundler
    steps:
      - run: |
          echo export BUNDLER_VERSION=2.1 >> $BASH_ENV
          source $BASH_ENV
          gem install bundler
  setup-packages:
    description: Bootstrap packages
    steps:
      - run: bundle exec rake bootstrap

jobs:
  test: 
    <<: *defaults
    steps:
      - checkout
      - install-bundler
      - setup-packages
      - run: bundle exec rake test

workflows:
  version: 2
  build:
    jobs:
      - test