version: 2.1

defaults: &defaults
  docker:
    - image: circleci/ruby:2.5.3-node-browsers
      environment:
        FIREFOX_VERSION: 68.0.1
        GECKODRIVER_VERSION: 0.24.0
  working_directory: ~/axe-core-gems

commands:
  install-bundler: 
    description: Install bundler
    steps:
      - run: bash ./.circleci/install-bundler.sh
  install-geckodriver:
    description: Install Geckodriver
    steps:
      - run: bash ./.circleci/install-geckodriver.sh
  setup-packages:
    description: Bootstrap packages
    steps:
      - run: rake bootstrap

jobs:
  test-unit: 
    <<: *defaults
    steps:
      - checkout
      - run: gem install bundler
      - install-geckodriver
      - setup-packages
      # test - API
      - run: rake test_unit\[axe-core-api\]
      # test - webdrivers
      - run: rake test_unit\[axe-core-selenium\]
      - run: rake test_unit\[axe-core-watir\]
      - run: rake test_unit\[axe-core-capybara\]
      # test - framework integrations
      - run: rake test_unit\[axe-core-cucumber\]
      - run: rake test_unit\[axe-core-rspec\]

workflows:
  version: 2
  build:
    jobs:
      - test-unit